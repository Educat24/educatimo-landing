<!DOCTYPE html>
<html lang="uk" class="quiz-html">
<head>
    <script>
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1427039129205224');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id=1427039129205224&ev=PageView&noscript=1" /></noscript>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Квіз: Чи готовий ваш центр до доказового навчання? — Neuro Educatimo</title>
    <meta name="description" content="Пройдіть короткий квіз і дізнайтесь, наскільки ваш центр готовий перейти до доказового підходу в навчанні.">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body class="quiz-page">

<!-- ШАПКА: фото класу (тільки на стартовому екрані) -->
<div class="quiz-hero-header" id="header-intro">
    <img src="/images/quiz-hero.png" alt="Клас">
    <a href="/uk/" class="quiz-logo">Neuro Educatimo</a>
</div>

<!-- ШАПКА: дошка + кружки (на екранах питань та форми) -->
<div class="quiz-board-header" id="header-board" style="display:none;">
    <a href="/uk/" class="quiz-logo-board">Neuro Educatimo</a>
    <div class="quiz-steps" id="quiz-steps">
        <div class="quiz-step" data-idx="0">1</div>
        <div class="quiz-step" data-idx="1">2</div>
        <div class="quiz-step" data-idx="2">3</div>
        <div class="quiz-step" data-idx="3">4</div>
        <div class="quiz-step" data-idx="4">5</div>
        <div class="quiz-step" data-idx="5">6</div>
    </div>
</div>

<!-- Екран 1 — Стартовий -->
<div class="quiz-screen active" id="screen-intro">
    <div class="quiz-card">
        <h1 class="quiz-intro-title">Перевірте свій центр за 6 запитань</h1>
        <p class="quiz-intro-desc">Дізнайтесь, де ваш центр зараз втрачає клієнтів і гроші, та отримайте персональний план дій — безкоштовно.</p>
        <div class="quiz-meta">
            <span class="quiz-meta-item"><i class="fas fa-clock"></i> 2 хвилини</span>
            <span class="quiz-meta-item"><i class="fas fa-list-ul"></i> 6 запитань</span>
            <span class="quiz-meta-item"><i class="fas fa-gift"></i> Безкоштовно</span>
        </div>
        <button class="btn quiz-btn" onclick="quizStart()">РОЗПОЧАТИ →</button>
    </div>
</div>

<!-- Екрани 2–7 — Питання -->
<div class="quiz-screen" id="screen-questions">
    <div class="quiz-card">
        <div class="quiz-question-label" id="quiz-step-label">ЗАПИТАННЯ 1 З 6</div>
        <h2 class="quiz-question" id="quiz-question-text"></h2>
        <div class="quiz-options" id="quiz-options"></div>
    </div>
</div>

<!-- Екран 8 — Фінальний з формою -->
<div class="quiz-screen" id="screen-result">
    <div class="quiz-card">
        <div id="quiz-form-section">
            <h2 class="quiz-result-title">Майже готово!</h2>
            <p class="quiz-result-desc">Залиште контакти — і ми надішлемо персоналізований розбір з першими кроками для вашого центру.</p>
            <form id="quiz-form" action="/api/register" method="POST">
                <input type="hidden" name="source" value="quiz">
                <input type="hidden" name="lang" value="uk">
                <input type="hidden" name="quiz_answers" id="quiz-answers-input">

                <label for="qf-org">Назва організації</label>
                <input type="text" id="qf-org" name="org_name" placeholder="Центр розвитку «Сонечко»" required>

                <label for="qf-email">Email</label>
                <input type="email" id="qf-email" name="email" placeholder="email@example.com" required>

                <label for="qf-phone">Телефон</label>
                <input type="tel" id="qf-phone" name="phone" placeholder="+380 XX XXX XX XX" required>

                <label for="qf-type">Тип закладу</label>
                <select id="qf-type" name="org_type" required>
                    <option value="" disabled selected>— Оберіть тип —</option>
                    <option value="center">Навчальний центр</option>
                    <option value="school">Школа або гімназія</option>
                    <option value="neuro">Нейропсихологічний центр</option>
                    <option value="other">Інше</option>
                </select>

                <label for="qf-students">Кількість учнів</label>
                <select id="qf-students" name="students_count" required>
                    <option value="" disabled selected>— Оберіть кількість —</option>
                    <option value="lt50">До 50 учнів</option>
                    <option value="50to200">50–200 учнів</option>
                    <option value="gt200">Більше 200 учнів</option>
                </select>

                <button type="submit" class="btn quiz-btn" id="quiz-submit-btn">ОТРИМАТИ РЕЗУЛЬТАТИ →</button>
                <div id="quiz-form-message"></div>
            </form>
        </div>
        <div class="quiz-success-block" id="quiz-success-block" style="display:none;">
            <div class="quiz-success-icon-large">✅</div>
            <h2 class="quiz-success-title">Дякуємо!</h2>
            <p class="quiz-success-subtitle">Ваша заявка прийнята.</p>
            <div class="quiz-success-body-box">
                <p>Протягом кількох годин на <strong id="success-email"></strong> надійде персоналізований звіт з результатами квізу.</p>
            </div>
            <p class="quiz-success-sign">З повагою, Команда Neuro.Educatimo</p>
        </div>
    </div>
</div>

<script>
var QUESTIONS = [
    { q: "Як ви зараз відстежуєте прогрес учнів?", opts: ["Тільки словесна оцінка педагога", "Домашні завдання та тести", "Стандартизовані тести раз на рік", "Регулярна цифрова діагностика"] },
    { q: "Як часто батьки скаржаться, що «не бачать результату»?", opts: ["Дуже часто — це головна причина відходу", "Час від часу, особливо через 2–3 місяці", "Рідко, але буває", "Майже ніколи — ми вміємо показувати прогрес"] },
    { q: "Чи є у вас стандартизована діагностика при вступі дитини?", opts: ["Ні, педагог оцінює сам", "Є кілька запитань/тестів, але неформальних", "Так, але різні педагоги роблять по-різному", "Так, єдиний стандарт для всіх"] },
    { q: "Скільки часу займає підготовка звіту для батьків?", opts: ["Понад годину — це великий біль", "30–60 хвилин", "10–30 хвилин", "До 10 хвилин — все автоматизовано"] },
    { q: "Чи пропонуєте ви батькам допродажі на основі даних про дитину?", opts: ["Ні, не знаємо що пропонувати", "Іноді, але інтуїтивно", "Пробували, але без системи", "Так, є чіткий процес на основі діагностики"] },
    { q: "Як швидко ваш центр може масштабуватись на нові філії?", opts: ["Важко — якість залежить від конкретних людей", "Повільно — потрібно навчати кожного педагога", "Середньо — є інструкції, але є складнощі", "Легко — у нас стандартизований процес"] }
];

var answers = {};
var currentQ = 0;

function updateHeader(screenId) {
    var intro = document.getElementById('header-intro');
    var board = document.getElementById('header-board');
    if (screenId === 'screen-intro') {
        intro.style.display = 'block';
        board.style.display = 'none';
    } else {
        intro.style.display = 'none';
        board.style.display = 'flex';
    }
}

function updateSteps(activeIdx, allCompleted) {
    var steps = document.querySelectorAll('.quiz-step');
    steps.forEach(function(el, i) {
        el.classList.remove('active', 'completed');
        if (allCompleted) {
            el.classList.add('completed');
        } else if (i < activeIdx) {
            el.classList.add('completed');
        } else if (i === activeIdx) {
            el.classList.add('active');
        }
    });
}

function quizStart() {
    updateHeader('screen-questions');
    showScreen('screen-questions');
    renderQuestion(0);
}

function showScreen(id) {
    document.querySelectorAll('.quiz-screen').forEach(function(s) { s.classList.remove('active'); });
    var el = document.getElementById(id);
    if (el) el.classList.add('active');
    updateHeader(id);
}

function renderQuestion(idx) {
    currentQ = idx;
    var total = QUESTIONS.length;
    document.getElementById('quiz-step-label').innerText = 'ЗАПИТАННЯ ' + (idx + 1) + ' З ' + total;
    document.getElementById('quiz-question-text').innerText = QUESTIONS[idx].q;
    updateSteps(idx, false);

    var opts = QUESTIONS[idx].opts;
    var container = document.getElementById('quiz-options');
    container.innerHTML = '';
    opts.forEach(function(opt, i) {
        var btn = document.createElement('button');
        btn.className = 'quiz-option';
        btn.innerText = opt;
        btn.onclick = function() { selectAnswer(idx, i, opt, btn); };
        container.appendChild(btn);
    });
}

function selectAnswer(qIdx, optIdx, optText, btn) {
    document.querySelectorAll('.quiz-option').forEach(function(b) { b.classList.remove('selected'); });
    btn.classList.add('selected');
    answers['q' + (qIdx + 1)] = optText;

    setTimeout(function() {
        if (qIdx + 1 < QUESTIONS.length) {
            renderQuestion(qIdx + 1);
        } else {
            document.getElementById('quiz-answers-input').value = JSON.stringify(answers);
            updateSteps(0, true);
            showScreen('screen-result');
        }
    }, 350);
}

document.getElementById('quiz-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    var btn = document.getElementById('quiz-submit-btn');
    var msg = document.getElementById('quiz-form-message');
    btn.disabled = true;
    btn.innerText = 'Відправляємо...';
    msg.innerText = '';
    document.getElementById('quiz-answers-input').value = JSON.stringify(answers);
    var submittedEmail = document.getElementById('qf-email').value;

    try {
        var formData = new FormData(this);
        var resp = await fetch('/api/register', { method: 'POST', body: formData, headers: { 'Accept': 'application/json' } });
        if (resp.ok) {
            // FB Lead: срабатывает когда форма успешно отправлена на почту (сервер вернул 2xx)
            if (typeof fbq === 'function') fbq('track', 'Lead');
            document.getElementById('quiz-form-section').style.display = 'none';
            document.getElementById('quiz-success-block').style.display = 'block';
            document.getElementById('success-email').innerText = submittedEmail;
            setTimeout(function() { window.location.href = '/uk/'; }, 4000);
        } else throw new Error('error');
    } catch(err) {
        msg.innerText = 'Виникла помилка. Спробуйте ще раз.';
        msg.style.color = 'red';
        btn.disabled = false;
        btn.innerText = 'ОТРИМАТИ РЕЗУЛЬТАТИ →';
    }
});
</script>

</body>
</html>
